<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Fan Control</title>
  <link rel="stylesheet" href="./css/style.css">
</head>
<body>
  <div id="top-right-area" class="top-right-area"></div>
  <button id="close-button" class="close-button hidden">X</button>
  <button id="settings-button" class="settings-button hidden">
    <img src="./assets/settings-icon.png" alt="Settings" />
  </button>
  <div id="settings-menu" class="settings-menu hidden">
    <button id="dark-mode-toggle" class="button">Toggle Dark Mode</button>
    <div class="divider"></div>
    <button id="devtools-button" class="button">Open DevTools</button>
    <div class="divider"></div>
    <button id="console-button" class="button">Debug to Console</button>
  </div>
  <div class="dashboard">
    <div id="weather" class="dashboard-item">Weather: Loading...</div>
    <div id="time" class="dashboard-item">Time: Loading...</div>
    <div id="date" class="dashboard-item">Date: Loading...</div>
    <div id="reminders" class="dashboard-item">Reminders: Loading...</div>
    <div id="smart-home" class="dashboard-item">Smart Home: Loading...</div>
  </div>
  <script src="./js/api.js"></script>
  <script src="./js/renderer.js"></script>
  <script>
    const closeButton = document.getElementById('close-button');
    const settingsButton = document.getElementById('settings-button');
    const settingsMenu = document.getElementById('settings-menu');
    const darkModeToggle = document.getElementById('dark-mode-toggle');
    const settingsIcon = settingsButton.querySelector('img');

    let isDarkMode = false;
    let mouseInTopArea = false;
    let mouseInSettingsMenu = false;

    document.addEventListener('mousemove', (event) => {
      if (event.clientY <= 50 || mouseInSettingsMenu) { // Check if cursor is in top area or settings menu
        mouseInTopArea = true;
        toggleButtonsVisibility(true);
      } else {
        mouseInTopArea = false;
        setTimeout(() => {
          if (!mouseInTopArea && !mouseInSettingsMenu) {
            toggleButtonsVisibility(false);
          }
        }, 300); // Delay to allow for smooth transitions
      }
    });

    settingsMenu.addEventListener('mouseenter', () => {
      mouseInSettingsMenu = true;
      toggleButtonsVisibility(true);
    });

    settingsMenu.addEventListener('mouseleave', () => {
      mouseInSettingsMenu = false;
      setTimeout(() => {
        if (!mouseInTopArea && !mouseInSettingsMenu) {
          toggleButtonsVisibility(false);
        }
      }, 300);
    });

    settingsButton.addEventListener('click', () => {
      settingsMenu.classList.toggle('hidden');
    });

    darkModeToggle.addEventListener('click', () => {
      isDarkMode = !isDarkMode;
      document.body.classList.toggle('dark-mode', isDarkMode);
      ipcRenderer.send('toggle-dark-mode', isDarkMode);

      // Update settings icon based on dark mode
      settingsIcon.src = isDarkMode ? './assets/settings-icon-dark.png' : './assets/settings-icon.png';
    });

    function toggleButtonsVisibility(visible) {
      const elements = [closeButton, settingsButton];
      elements.forEach(el => el.classList.toggle('hidden', !visible));
    }
  </script>
</body>
</html>
